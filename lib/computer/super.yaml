# lib/computer/super.yaml
# Supercompilation - Futamura Projections and Program Optimization

# --- Core Boxes ---

interpreter: &interpreter
  !box
    name: interpreter
    type: [Language2, Language]
    desc: "Async interpreter for meta-compilation"

specializer: &specializer
  !box
    name: specializer
    type: [Language2, Language]
    desc: "Partial evaluator / Specializer"

compiler: &compiler
  !box
    name: compiler
    type: [Language2, Language]
    desc: "Compiler generated via second Futamura projection"

compiler_generator: &compiler_generator
  !box
    name: compiler_generator
    type: [Language, Language]
    desc: "Compiler generator via third Futamura projection"

# --- Futamura Projections as Diagrams ---

# First Futamura: specializer(interpreter, program) = compiled_program
futamura1_diagram: &futamura1_diagram
  !seq
    - !copy 2  # Duplicate inputs (interpreter, program)
    - !seq
        - !id
        - *specializer  # Apply specializer to (interpreter, program)

# Second Futamura: specializer(specializer, interpreter) = compiler  
futamura2_diagram: &futamura2_diagram
  !seq
    - !copy 2  # Duplicate inputs (interpreter, specializer)
    - !swap    # Swap to get (specializer, interpreter)
    - *specializer  # Apply specializer

# Third Futamura: specializer(specializer, specializer) = compiler_generator
futamura3_diagram: &futamura3_diagram
  !seq
    - !copy 2  # Duplicate specializer
    - *specializer  # Apply to itself

# --- Specialization Pattern ---

# Specialize: static_data @ program >> Copy @ Id >> Id @ eval
specialize_pattern: &specialize_pattern
  !seq
    - !tensor  # static_data @ program
        - !id
        - !id
    - !copy 2  # Duplicate static_data
    - !tensor  # (static_data @ static_data) @ program
        - !id
        - !id

# --- Futamura Projections (Box Interface) ---

futamura1: &futamura1
  !box
    name: futamura_1
    type: [Language2, Language]
    desc: "First Futamura projection: specializer(interpreter, program) = compiled_program"

futamura2: &futamura2
  !box
    name: futamura_2
    type: [Language2, Language]
    desc: "Second Futamura projection: specializer(specializer, interpreter) = compiler"

futamura3: &futamura3
  !box
    name: futamura_3
    type: [Language, Language]
    desc: "Third Futamura projection: specializer(specializer, specializer) = compiler_generator"

# --- Supercompilation ---

supercompile: &supercompile
  !box
    name: supercompile
    type: [Language, Language]
    desc: "Supercompilation transformation with driving, folding, and generalization"

partial_eval: &partial_eval
  !box
    name: partial_eval
    type: [Language2, Language]
    desc: "Partial evaluation with static input"

# --- Exports ---

__all__:
  - interpreter
  - specializer
  - compiler
  - compiler_generator
  - futamura1
  - futamura2
  - futamura3
  - futamura1_diagram
  - futamura2_diagram
  - futamura3_diagram
  - specialize_pattern
  - supercompile
  - partial_eval
